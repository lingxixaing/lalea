<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title></title>
        <link rel="stylesheet" href="../css/订单界面.css" />
        <style>
            #w {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                justify-content: center;
                align-items: center;
                z-index: 999;
            }

            #wll {
                width: 1000px;
                height: 500px;
                background: white;
                padding: 10px 20px 20px 20px;
                border-radius: 5px;
                text-align: center;

            }

            #wll input {
                width: 480px;
                height: 28px;
                margin-top: 5px;
                margin-left: 10px;
            }

            #yuichu {
                /* margin-left: 1500px; */
                background-color: rgba(255, 255, 255, 0.5);
                border: 0 solid black;
                color: #000000;
                float: right;
                display: flex;
                right: 10px;
            }

            .zyg {
                margin-left: 900px;
            }
        </style>
    </head>
    <body>
        <button onclick="w.style.display='flex'">新增订单</button>
        <div id="w">
            <div id="wll">
                <button id="yuichu" onclick="w.style.display='none'">X</button>
                <input type="text" id="ddbh" value="" placeholder="订单编号" class="zyg" />
                <input type="text" id="xslx" value="" placeholder="显示类型" />
                <input type="text" id="yhlx" placeholder="用户类型" />
                <input type="text" id="yhmc" placeholder="用户名称" />
                <p>启动时间</p>
                <input type="datetime-local" id="qdsj" placeholder="启动时间" value="" />
                <p>下单时间</p>
                <input type="datetime-local" id="xdsj" placeholder="下单时间" value="" />
                <input type="number" id="sl" value="" placeholder="数量" />
                <input type="number" id="zpsj" value="" placeholder="装配时间" />
                <input type="number" id="zpcs" value="" placeholder="装配次数" />
                <input type="number" id="zksj" value="" placeholder="钻孔时间" />
                <input type="number" id="zkcs" value="" placeholder="钻孔次数" />
                <input type="submit" value="提交订单" onclick="tjdd()" />

            </div>
        </div>

        <div class=" ymtz">
            <ul>
                <li><a href="首页.html">首页</a></li>
                <li><a href="状态界面.html">状态监控</a></li>
                <li><a href="数据监控.html">数据监控</a></li>
                <li><a href="订单界面.html">订单界面</a></li>
                <li><a href="订单查询.html">订单查询</a></li>
                <li><a href="报警记录.html">报警记录</a></li>
                <li><a href="用户管理.html">用户管理</a></li>
            </ul>
        </div>

        <script>
            const storedUsername = localStorage.getItem('username');
            const storedUsertype = localStorage.getItem('usertype');
            if (storedUsername) {
                document.getElementById('yhmc').value = storedUsername;
            }
            if (storedUsertype) {
                document.getElementById('yhlx').value = storedUsertype;
            }

            function tjdd() {
                const ddbh = document.getElementById('ddbh').value;
                const xslx = document.getElementById('xslx').value;
                const yhlx = document.getElementById('yhlx').value;
                const yhmc = document.getElementById('yhmc').value;
                let qdsj = document.getElementById('qdsj').value;
                let xdsj = document.getElementById('xdsj').value;
                const sl = document.getElementById('sl').value;
                const zpsj = document.getElementById('zpsj').value;
                const zpcs = document.getElementById('zpcs').value;
                const zkcs = document.getElementById('zkcs').value;
                const zksj = document.getElementById('zksj').value;

                if (!ddbh || !xslx || !yhlx || !yhmc || !qdsj || !xdsj || !sl || !zpsj || !zpcs || !zkcs) {
                    alert('请填写信息');
                    return;
                }

                qdsj = qdsj ? qdsj.replace('T', ' ') + ':00' : qdsj;
                xdsj = xdsj ? xdsj.replace('T', ' ') + ':00' : xdsj;

                const data = {
                    ddbh,
                    xslx,
                    yhlx,
                    yhmc,
                    qdsj,
                    xdsj,
                    sl,
                    zpsj,
                    zpcs,
                    zksj,
                    zkcs
                };
                fetch('http://127.0.0.1:1880/xd', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    })
                    .then(() => {
                        alert('下单成功');
                        document.getElementById('ddbh').value = '';
                        document.getElementById('xslx').value = '';
                        document.getElementById('yhlx').value = storedUsertype;
                        document.getElementById('yhmc').value = storedUsername;
                        document.getElementById('qdsj').value = '';
                        document.getElementById('xdsj').value = '';
                        document.getElementById('sl').value = '';
                        document.getElementById('zpsj').value = '';
                        document.getElementById('zpcs').value = '';
                        document.getElementById('zksj').value = '';
                        document.getElementById('zkcs').value = '';
                        document.getElementById('w').style.display = 'none'; // 添加关闭弹窗的代码
                    })
            }
        </script>
    </body>
</html>